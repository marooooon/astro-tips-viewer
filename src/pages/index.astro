---
import type { Post } from '../types/post';
import PostCard from '../components/PostCard.astro';
import Filter from '../components/Filter';
import '../styles/global.css';

// JSONãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€å‹ã‚’é©ç”¨
import postsData from '../data/posts.json';
const posts: Post[] = postsData;

// æ—¥ä»˜ã®é™é †ã§ã‚½ãƒ¼ãƒˆ
const sortedPosts = [...posts].sort((a, b) => 
  new Date(b.date).getTime() - new Date(a.date).getTime()
);
---

<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tips Viewer - æŠ€è¡“Tipsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</title>
    <meta name="description" content="é–‹ç™ºã«å½¹ç«‹ã¤æŠ€è¡“Tipsã‚’é›†ã‚ãŸãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼" />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>ğŸ“š Tips Viewer</h1>
        <p>é–‹ç™ºã«å½¹ç«‹ã¤æŠ€è¡“Tipsã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</p>
      </header>

      <main>
        <!-- Filterã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆReact Islandï¼‰ -->
        <Filter client:load posts={sortedPosts} />

        <!-- è¨˜äº‹ä¸€è¦§ï¼ˆåˆæœŸè¡¨ç¤ºï¼‰ -->
        <div id="posts-container">
          {sortedPosts.map((post) => (
            <PostCard post={post} />
          ))}
        </div>
      </main>

      <footer class="footer">
        <p>&copy; 2026 Tips Viewer - Built with Astro & TypeScript</p>
      </footer>
    </div>

    <script>
      import type { Post } from '../types/post';

      // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµæœã‚’åæ˜ 
      const postsContainer = document.getElementById('posts-container');
      
      // ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ•ã‚£ãƒ«ã‚¿çµæœã‚’å—ã‘å–ã‚‹
      window.addEventListener('postsFiltered', ((event: CustomEvent<Post[]>) => {
        if (!postsContainer) return;
        
        const filteredPosts = event.detail;
        
        if (filteredPosts.length === 0) {
          postsContainer.innerHTML = '<p class="no-results">è©²å½“ã™ã‚‹è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
          return;
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµæœã‚’è¡¨ç¤ºï¼ˆPostCardã®HTMLã‚’å‹•çš„ç”Ÿæˆï¼‰
        postsContainer.innerHTML = filteredPosts.map(post => `
          <article class="post-card">
            <div class="post-card-header">
              <h2>
                <a href="/posts/${post.id}">${post.title}</a>
              </h2>
              <time datetime="${post.date}">${post.date}</time>
            </div>
            <p class="post-description">${post.description}</p>
            <div class="post-tags">
              ${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
            </div>
          </article>
        `).join('');
      }) as EventListener);
    </script>
  </body>
</html>
